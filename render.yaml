services:
  # API Gateway Service
  - type: web
    name: pet-care-api-gateway
    runtime: node
    plan: free
    buildCommand: cd backend/api-gateway && npm install && npm ci && npm run build
    startCommand: cd backend/api-gateway && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "3000"
      - key: CHAT_SERVICE_URL
        value: https://pet-care-chat-service.onrender.com
      - key: AUTH_SERVICE_URL
        value: https://pet-care-auth-service.onrender.com
      - key: PET_SERVICE_URL
        value: https://pet-care-pet-service.onrender.com
      - key: BILLING_SERVICE_URL
        value: https://pet-care-billing-service.onrender.com
      - key: REMINDERS_SERVICE_URL
        value: https://pet-care-reminders-service.onrender.com
      - key: RATE_LIMIT_WINDOW_MS
        value: "900000"
      - key: RATE_LIMIT_MAX_REQUESTS
        value: "1000"
      - key: LOG_LEVEL
        value: info
      - key: TRUST_PROXY
        value: true
      - key: TRUST_PROXY_COUNT
        value: "1"  
    
    
  # Auth Service
  - type: web
    name: pet-care-auth-service
    runtime: node
    plan: free
    buildCommand: cd backend/auth-services && npm install && npm ci && npm run build
    startCommand: cd backend/auth-services && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        sync: false
      - key: TRUST_PROXY
        value: true
      - key: TRUST_PROXY_COUNT
        value: "1"  
      
  # Pet Service
  - type: web
    name: pet-care-pet-service
    runtime: node
    plan: free
    buildCommand: cd backend/pet-services && npm install && npm run build
    startCommand: cd backend/pet-services && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        sync: false
      - key: TRUST_PROXY
        value: true
      - key: TRUST_PROXY_COUNT
        value: "1"  

      
  # Billing Service
  - type: web
    name: pet-care-billing-service
    runtime: node
    plan: free
    buildCommand: cd backend/billing-service && npm install && npm run build
    startCommand: cd backend/billing-service && npm start
    envVars:
      - key: STRIPE_SECRET_KEY
        sync: false
        
  # Reminders Service
  - type: web
    name: pet-care-reminders-service
    runtime: node
    plan: free
    buildCommand: cd backend/reminders-service && npm install && npm run build
    startCommand: cd backend/reminders-service && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: JWT_SECRET
        sync: false
      - key: TRUST_PROXY
        value: true
      - key: TRUST_PROXY_COUNT
        value: "1"  

  # Chat Service
  - type: web
    name: pet-care-chat-service
    runtime: node
    plan: free
    buildCommand: cd backend/chat-service && npm install && npm run build
    startCommand: cd backend/chat-service && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "4000"
      - key: GROK_API_URL
        value: ""
      - key: GROK_API_KEY
        sync: false
      - key: GROK_FREE_MODEL
        value: "grok-mini"
      - key: GROK_MAX_TOKENS
        value: "512"
      - key: TRUST_PROXY
        value: true
      - key: TRUST_PROXY_COUNT
        value: "1"

